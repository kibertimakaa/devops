
# Подробная работа TCP и IP с примерами

---

## Общая модель и уровни TCP/IP

TCP/IP разбит на уровни, где IP работает на сетевом уровне, а TCP — на транспортном.

- Канальный уровень отвечает за передачу данных между физическими устройствами в пределах одной сети, используя протоколы Ethernet, Wi-Fi и др.
- Сетевой уровень, где работает IP, управляет адресацией и маршрутизацией пакетов.
- Транспортный уровень протокола TCP обеспечивает надежную передачу данных между приложениями.
- Прикладной уровень определяет протоколы, с которыми взаимодействует пользователь (HTTP, SMTP и др.) [web:4][web:8].

---

## Протокол IP (Internet Protocol)

IP занимается маршрутизацией и доставкой пакетов данных по сети. Существует две версии IP:

- IPv4 с 32-битным адресом (пример: 192.168.1.1), что дает 4,3 миллиарда уникальных адресов.
- IPv6 с 128-битным адресом, что значительно расширяет адресное пространство.

### Формат IPv4 заголовка (пример с описанием битов)

Заголовок IPv4 имеет длину от 20 до 60 байт. Главное состоит из следующих полей (в скобках — битовая длина):

| Поле               | Битов | Описание                                                                                          |
|--------------------|--------|--------------------------------------------------------------------------------------------------|
| Version            | 4      | Версия IP (для IPv4 это 4)                                                                        |
| IHL                | 4      | Длина заголовка в 32-битных словах                                                              |
| Type of Service    | 8      | Приоритет и тип сервиса                                                                           |
| Total Length       | 16     | Общая длина пакета (заголовок + данные)                                                         |
| Identification     | 16     | Уникальный идентификатор для фрагментации                                                       |
| Flags              | 3      | Флаги, управляющие фрагментацией                                                                 |
| Fragment Offset    | 13     | Смещение фрагмента                                                                               |
| TTL                | 8      | Время жизни пакета                                                                               |
| Protocol           | 8      | Протокол следующего уровня (6 для TCP)                                                           |
| Header Checksum    | 16     | Контрольная сумма заголовка                                                                       |
| Source IP Address  | 32     | IP-адрес отправителя                                                                             |
| Destination IP Address | 32  | IP-адрес получателя                                                                             |

Каждый из этих битов и полей строго определён в RFC 791 и обеспечивает доставку пакетов по сети.

---

## Протокол TCP (Transmission Control Protocol)

TCP — протокол транспортного уровня, обеспечивающий надежность, контроль ошибок, порядок и контроль потока при передаче данных.

### Формат TCP сегмента:

| Поле                | Битов | Описание                                                                                                    |
|---------------------|--------|--------------------------------------------------------------------------------------------------------------|
| Source Port         | 16     | Порт отправителя                                                                                            |
| Destination Port    | 16     | Порт получателя                                                                                             |
| Sequence Number     | 32     | Порядковый номер байта первого сегмента данных                                                              |
| Acknowledgment Number | 32     | Номер следующего ожидаемого байта (подтверждение)                                                          |
| Data Offset         | 4      | Длина заголовка TCP                                                                                          |
| Reserved            | 6      | Зарезервировано для будущего использования                                                                   |
| Flags               | 6      | Управляющие флаги (URG, ACK, PSH, RST, SYN, FIN)                                                           |
| Window Size         | 16     | Размер окна — объем данных, который можно принять                                                           |
| Checksum            | 16     | Контрольная сумма всего сегмента                                                                             |
| Urgent Pointer      | 16     | Указывает на данные с высоким приоритетом                                                                   |
| Options             | переменная | Дополнительные опции                                                                                        |

### Трехстороннее рукопожатие TCP

Для установления соединения TCP использует механизм трехстороннего рукопожатия:

1. Клиент отправляет сегмент с флагом SYN и случайным порядковым номером.
2. Сервер отвечает сегментом с флагами SYN+ACK, подтверждая получение и отправляя свой порядковый номер.
3. Клиент отвечает сегментом с флагом ACK, завершая установку соединения.

Это позволяет гарантировать установку надежного двунаправленного канала для передачи данных [web:3][web:7].

---

## Пример битового значения флагов TCP

Флаги 6 бит в TCP сегменте кодируются так (биты с 5 по 0):

| Флаг | Значение битa |
|-------|--------------|
| URG   | 5            |
| ACK   | 4            |
| PSH   | 3            |
| RST   | 2            |
| SYN   | 1            |
| FIN   | 0            |

Например, сегмент SYN+ACK будет иметь флаги 00010010 (0x12 в шестнадцатеричной системе), что означает, что установлены биты SYN и ACK.

---

В итоге, TCP/IP — это комплекс методов и форматов данных, где каждый бит в заголовках IP и TCP строго определяет параметры маршрутизации, надежности и управления сетевой передачей.
IP отвечает за доставку пакетов до нужного адресата, а TCP обеспечивает надежный обмен данными между приложениями с контролем ошибок и порядком передачи

